# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

このリポジトリは、Claude Codeのスキルとして使用するソフトウェア設計ドキュメント（SDD）管理システムです。EARS記法を用いた要件定義、技術設計、タスク管理の3つのドキュメントファイルを構造化されたプロセスで作成・管理します。

## 主要コンポーネント

### sdd-docs/
プロジェクトのメインコンテンツを格納するディレクトリ：
- **SKILL.md** - スキルの定義ファイル（Claude Codeがスキルとして認識）
- **assets/templates/** - 3つのドキュメントテンプレート
  - requirements_template_ja.md - 要件定義テンプレート
  - design_template_ja.md - 設計テンプレート
  - tasks_template_ja.md - タスク管理テンプレート
- **references/** - リファレンスドキュメント
  - ears_notation_ja.md - EARS記法の詳細ガイド
  - examples_ja.md - 3つすべてのドキュメントタイプの実例

## スキルの使用方法

このスキルが有効化されると、以下の3つのドキュメントを`docs`ディレクトリに作成・管理します：

1. **requirements.md** - EARS記法を用いたユーザーストーリーと受入基準
2. **design.md** - 技術アーキテクチャ、コンポーネント、実装詳細
3. **tasks.md** - 追跡可能な個別タスクへの作業分解

### EARS記法の基本パターン

| パターン | 形式 | 使用場面 |
|---------|------|----------|
| 基本 | `システムは〜しなければならない` | 常時適用される要件 |
| イベント | `〜の時、システムは〜しなければならない` | イベント駆動要件 |
| 条件 | `もし〜ならば、システムは〜しなければならない` | 状態依存要件 |
| 継続 | `〜の間、システムは〜しなければならない` | 継続的要件 |
| 場所 | `〜において、システムは〜しなければならない` | コンテキスト固有要件 |

## アーキテクチャ

### ドキュメントの関係性
```
requirements.md (何を作るか)
    ↓
design.md (どのように作るか)
    ↓
tasks.md (どのように実装するか)
```

### ワークフロー
1. **初期化** - docsディレクトリとテンプレートファイルを作成
2. **要件定義** - EARS記法を使って何を作るかを定義
3. **設計** - どのように作るかを文書化
4. **タスク計画** - 実装を計画
5. **レビュー** - ドキュメントの品質をチェック
6. **反復** - プロジェクトの進展に応じて更新

## ドキュメント作成時の重要原則

### 情報の明確性（最重要）
すべてのドキュメント作成において、以下の原則を厳守してください：

1. **情報の分類**
   - ユーザーの指示から「明示された情報」と「不明な情報」を分けてリストアップ
   - 「おそらく〜だろう」という推測は「不明」として扱う
   - 推測に基づく設計・タスク作成は行わない

2. **不明な情報の確認**
   - 不明な情報が1つでもあれば、実装前に必ず質問する
   - 確認なしに推測で進めない
   - すべての不明点が解消されてから設計・タスク作成を開始

3. **サブエージェント向け完全性**
   - 設計書・タスクには、サブエージェントが質問なしに実装できるレベルの情報を記載
   - ファイルパス、型定義、入出力仕様、エラー処理など具体的に記述

### 要件定義（requirements.md）
- すべての要件はEARS記法に従う
- 要件IDは一意（REQ-XXX、NFR-XXX）
- 各要件はテスト可能で測定可能
- 「しなければならない」で統一（「すべきである」「できる」は使わない）
- 具体的な値を使用（「高速」ではなく「2秒以内」）

### 設計（design.md）
- アーキテクチャ図にはMermaid形式を使用
- コンポーネントの目的、責務、インターフェースを明記
- 技術的決定事項には選択肢と根拠を記載
- データフロー図でシーケンスを視覚化
- **「情報の明確性チェック」セクションを必ず含める**
- **不明/要確認の情報がすべて解消されていることを確認**

### タスク管理（tasks.md）
- タスクは適切な粒度に分解（AIエージェント作業時間で20-40分程度）
- 各タスクに受入基準、依存関係、見積もり時間を記載
- ステータス: `TODO`, `IN_PROGRESS`, `BLOCKED`, `REVIEW`, `DONE`
- フェーズごとにグループ化して管理
- **各タスクに「情報の明確性」セクションを含める**
- **推測に基づく実装指示を含めない**

## 検証チェックリスト

ドキュメントをレビューする際の確認項目：

### 要件定義書
- ✅ ユーザーストーリーが明確に定義されている
- ✅ すべての要件がEARS記法に従っている
- ✅ 要件IDが一意である
- ✅ 各要件がテスト可能である
- ✅ 非機能要件が含まれている

### 設計書
- ✅ アーキテクチャ概要が記載されている
- ✅ 主要コンポーネントが定義されている
- ✅ インターフェースが明確である
- ✅ 技術的決定事項と根拠が記載されている
- ✅ 必要に応じて図表が含まれている
- ✅ **情報の明確性チェックが完了している**
- ✅ **不明/要確認の情報がすべて解消されている**

### タスク管理書
- ✅ タスクが適切な粒度に分解されている
- ✅ 各タスクに受入基準がある
- ✅ 依存関係が明確である
- ✅ 見積もり時間が記載されている
- ✅ ステータスが有効な値である
- ✅ **各タスクの「情報の明確性」セクションが記載されている**
- ✅ **推測に基づく実装指示が含まれていない**

## 逆順レビュープロセス（整合性チェック）

ドキュメント作成・修正後は、逆順（タスク → 設計 → 要件）でレビューを行い、矛盾や過不足を確認する：

### チェックの流れ
```
tasks.md → design.md → requirements.md
```

### 確認項目
1. **タスク → 設計**: タスクが参照するコンポーネント/APIは設計書に定義されているか
2. **設計 → 要件**: すべての要件（REQ-XXX）に対応する設計要素があるか
3. **過剰チェック**: 要件にない機能が設計やタスクに含まれていないか
4. **漏れチェック**: 設計やタスクに対応しない要件がないか

### 不整合発見時
矛盾や過不足を発見した場合は、**ユーザーに確認してからドキュメントを修正する**

## リファレンスの活用

- 詳細なEARS記法のガイド: `sdd-docs/references/ears_notation_ja.md`
- 実装例（ECショッピングカート、タスク管理API、ユーザー認証）: `sdd-docs/references/examples_ja.md`
- テンプレートファイル: `sdd-docs/assets/templates/`

## ベストプラクティス

1. **なぜから始める** - 目的を理解するためユーザーストーリーから開始
2. **具体的に** - 測定可能な値を使用
3. **要件ごとに1つ** - 複合要件を避ける
4. **すべてをテスト可能に** - 各要件は検証可能でなければならない
5. **依存関係を追跡** - 関連タスクを明確にリンク
6. **最新を保つ** - 作業の進行に応じてステータスを更新
7. **情報を分類する** - 明示された情報と不明な情報を常に区別する
8. **推測しない** - 「おそらく〜」は「不明」として扱い、必ず確認する
