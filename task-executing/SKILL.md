---
name: task-executing
description: docs/tasks.mdに記載されたタスクを実行し、実装を行います。タスクごとにステータス更新とコミットを作成し、実装完了後は逆順レビュー（実装→タスク→設計→要件）で整合性を確認します。SDDワークフローの実装フェーズで使用してください。
---

# タスク実行スキル

docs/tasks.mdに記載されたタスクを実行し、SDDワークフローに沿った実装を行います。

## 概要

このスキルは、SDDワークフローの実装フェーズを担当します：

```text
requirements-defining → software-designing → task-planning → task-executing
   (requirements.md)      (design.md)         (tasks.md)      (実装)
```

### 主な機能
- docs/tasks.mdからタスクを読み取り、実行順序を決定
- タスクごとのステータス更新（TODO → IN_PROGRESS → DONE）
- 統一されたコミットテンプレートによるGit管理
- 実装後の逆順レビュー（実装→タスク→設計→要件の整合性確認）
- 並列実行可能なタスクの並列処理

## このスキルを使用する場面

### 実装フェーズ
- docs/tasks.mdのタスクを実行する場合
- SDDに沿った実装を行う場合
- タスクの進捗を管理したい場合

### SDDワークフロー統合
- sdd-documentationスキルから呼び出される場合
- 実装後の整合性確認が必要な場合

## ワークフロー

### 実行フロー

```text
1. tasks.md読み取り
   ↓
2. 実行可能なタスクを特定
   ↓
3. ステータスをIN_PROGRESSに更新
   ↓
4. サブエージェントで実装
   ↓
5. 受入基準の確認
   ↓
6. コミット作成（テンプレート使用）
   ↓
7. ステータスをDONEに更新
   ↓
8. tasks.md更新をコミット
   ↓
9. 逆順レビュー（実装→タスク→設計→要件）
   ↓
10. 次のタスクへ（または完了）
```

## タスクステータス管理

### ステータス遷移

```text
TODO → IN_PROGRESS → DONE
         ↓
      BLOCKED（問題発生時）
         ↓
    IN_PROGRESS（問題解消後）
```

### ステータス更新タイミング

| タイミング | ステータス | アクション |
|-----------|-----------|-----------|
| タスク開始時 | `IN_PROGRESS` | tasks.mdを更新、コミット |
| タスク完了時 | `DONE` | 完了サマリー追加、tasks.mdを更新、コミット |
| 問題発生時 | `BLOCKED` | ブロック理由を記載、tasks.mdを更新 |

### ステータス更新の形式

```markdown
#### タスク1.1: [タイトル]

**説明**: [元の説明]
**受入基準**: [元の受入基準]
**ステータス**: `DONE`
**完了サマリー**: POST /api/auth/login, /logoutを実装。JWT認証とbcryptハッシュ化を適用。
```

## Gitコミットテンプレート

### 実装コミット

```text
[タスクID] タスクタイトル

## 実装内容
- 実装した機能の説明
- 主な変更点

## 受入基準の達成状況
- [x] 基準1
- [x] 基準2

## 関連ドキュメント
- docs/tasks.md: タスクID
- docs/design.md: 関連コンポーネント
- docs/requirements.md: 関連要件ID

## テスト
- テスト実行結果（npm test等）
```

**例**:
```text
[Task 1.1] ユーザー認証APIエンドポイントの実装

## 実装内容
- POST /api/auth/login エンドポイントを実装
- POST /api/auth/logout エンドポイントを実装
- JWTトークン生成・検証ロジックを追加
- bcryptによるパスワードハッシュ化を実装

## 受入基準の達成状況
- [x] login/logoutエンドポイントが実装されている
- [x] JWTトークンが正しく生成・検証される
- [x] パスワードがbcryptでハッシュ化されている
- [x] エラーハンドリングが適切に実装されている
- [x] ユニットテストが実装され、すべて通過する

## 関連ドキュメント
- docs/tasks.md: Task 1.1
- docs/design.md: AuthenticationComponent
- docs/requirements.md: REQ-001, REQ-002

## テスト
npm test: 15 passed, 0 failed
```

### ステータス更新コミット

```text
Update tasks.md: タスクID completed

タスクタイトルを完了としてマーク。
完了サマリー: [1行の要約]
```

**例**:
```text
Update tasks.md: Task 1.1 completed

ユーザー認証APIエンドポイントの実装を完了としてマーク。
完了サマリー: POST /api/auth/login, /logoutを実装。JWT認証とbcryptハッシュ化を適用。
```

### 重要な変更前のセーフポイントコミット

```text
[タスクID] Safe point before: 変更の説明

大規模な変更を開始する前の安定した状態を保存。

次の変更予定:
- 変更内容1
- 変更内容2
```

## 逆順レビュー（実装後の整合性確認）

### レビューの流れ

```text
実装 → tasks.md → design.md → requirements.md
```

### チェック項目

#### 1. 実装 → タスクの整合性

| チェック項目 | 確認内容 |
|-------------|---------|
| 受入基準達成 | すべての受入基準が満たされているか |
| ファイル一致 | タスクで指定されたファイルが作成されているか |
| テスト通過 | 指定されたテストがすべて通過するか |
| コード品質 | ESLint/TypeScriptエラーがないか |

#### 2. タスク → 設計の整合性

| チェック項目 | 確認内容 |
|-------------|---------|
| コンポーネント対応 | 実装がdesign.mdのコンポーネント定義と一致するか |
| API対応 | APIの実装がdesign.mdの仕様と一致するか |
| データモデル対応 | データ構造がdesign.mdのスキーマと一致するか |

#### 3. 設計 → 要件の整合性

| チェック項目 | 確認内容 |
|-------------|---------|
| 要件カバレッジ | 実装が対応する要件（REQ-XXX）を満たしているか |
| 非機能要件 | NFR-XXXの要件が満たされているか |
| 過剰実装チェック | 要件にない機能が実装されていないか |

### 不整合発見時の報告

```text
逆順レビューで以下の不整合を発見しました：

【実装 → タスクの不整合】
1. Task 1.1の受入基準「エラーハンドリングが適切に実装されている」
   が満たされていません。
   → 400エラー時のレスポンス形式がdesign.mdと異なります。

【タスク → 設計の不整合】
2. 実装したUserServiceにvalidateEmail()メソッドがありますが、
   design.mdのUserService定義に含まれていません。

【設計 → 要件の不整合】
3. REQ-003「パスワードリセット機能」に対応する実装がありません。

対応方法を選択してください：
1. 実装を修正する
2. ドキュメントを更新する（要確認事項として記録）
3. 次のタスクに進む（後で対応）
```

## タスク実行の詳細

### ステップ1: タスクの読み取りと分析

```markdown
1. docs/tasks.mdを読み取る
2. 各タスクの情報を抽出
   - タスクID
   - タスクタイトル
   - 説明
   - 受入基準
   - 依存関係
   - ステータス
   - 推定工数
3. TODO状態のタスクをフィルタリング
4. 依存関係を確認
```

### ステップ2: 実行計画の提示

```text
以下のタスクを実行します：

【実行対象】
- Task 1.1: ユーザー認証APIエンドポイントの実装
  依存関係: なし
  推定工数: 30分

【実行手順】
1. ステータスをIN_PROGRESSに更新
2. サブエージェントで実装
3. 受入基準を確認
4. コミット作成
5. ステータスをDONEに更新
6. 逆順レビュー実施

実行を開始してよろしいですか？
```

### ステップ3: 実装実行

サブエージェントに以下の情報を提供：
- タスクの完全な説明
- 受入基準
- 技術的文脈
- 参照すべき既存コード
- design.md、requirements.mdの関連セクション

### ステップ4: 受入基準の確認

実装完了後、すべての受入基準を確認：

```text
【受入基準の確認】
- [x] login/logoutエンドポイントが実装されている
- [x] JWTトークンが正しく生成・検証される
- [x] パスワードがbcryptでハッシュ化されている
- [x] エラーハンドリングが適切に実装されている
- [x] ユニットテストが実装され、すべて通過する

すべての受入基準を達成しました。コミットを作成します。
```

### ステップ5: コミット作成

コミットテンプレートに従ってコミットを作成。

### ステップ6: 逆順レビュー

実装→タスク→設計→要件の整合性を確認。

## 並列実行（Agentベース）

### 並列実行の条件

- 依存関係フィールドが空、または「なし」
- 前提となるタスクがすべて完了済み
- 異なるファイル・コンポーネントを対象とする

### Agentによる並列実装

**重要**: 並列実行可能なタスクは、Taskツール（subagent_type=general-purpose）を使用して同時に実装を進めます。

```text
【並列実行の手順】
1. tasks.mdを分析し、並列実行可能なタスクを特定
2. 各タスクに対してAgentを起動（1つのメッセージで複数のTaskツールを呼び出す）
3. 各Agentは独立してタスクを実装
4. すべてのAgentが完了後、結果を統合
5. 逆順レビューを実施
```

### Agent起動の例

```text
以下のタスクを並列で実行します：

【Task 1.1】ユーザー認証APIの実装
→ Agent 1を起動

【Task 1.2】ユーザー登録APIの実装
→ Agent 2を起動

【Task 1.3】パスワードリセットAPIの実装
→ Agent 3を起動

各Agentには以下の情報を渡します：
- タスクの詳細（説明、受入基準）
- 関連するdesign.md、requirements.mdのセクション
- コーディング規約とコミットテンプレート
- テスト要件（カバレッジ80%以上）
```

### Agent実行時の注意事項

1. **コンテキストの共有**: 各Agentに十分な情報を渡す
2. **ファイル競合の回避**: 異なるファイルを対象とするタスクのみ並列化
3. **コミット順序**: 各Agent完了後、メインプロセスで順次コミット
4. **エラーハンドリング**: 1つのAgentが失敗しても他のAgentは継続
5. **結果の検証**: すべてのAgent完了後にテストを実行

## エラーハンドリング

### タスク実行中のエラー

1. エラー内容をユーザーに報告
2. 部分的に完了した作業をコミット（セーフポイント）
3. タスクのステータスをBLOCKEDに変更
4. エラー原因と対処方法を記録
5. ユーザーに次の行動を確認

### 例

```text
Task 1.1の実行中にエラーが発生しました：

【エラー内容】
npm install時に依存関係の競合が発生

【実施した内容】
- 基本的なファイル構造を作成（コミット済み）
- パッケージのインストールは未完了

【ステータス】
Task 1.1: BLOCKED

【次の行動】
1. 依存関係の競合を解決してから再実行
2. このタスクをスキップして次のタスクへ進む

どちらにしますか？
```

## 制約事項

### 自動実行を行わない場合

1. **タスクの曖昧性**: 受入基準が明確でない、実装方法が複数考えられる
2. **リスクの高い操作**: 本番環境への変更、データベースの削除操作
3. **ユーザーの判断が必要**: 技術選択、アーキテクチャの決定

これらの場合はユーザーに確認を求めます。

## ベストプラクティス

1. **タスク開始時に必ずステータス更新**: IN_PROGRESSに変更してからコミット
2. **コミットテンプレートを厳守**: 関連ドキュメントへの参照を必ず含める
3. **受入基準を全て確認**: 一部でも未達成なら完了としない
4. **逆順レビューを省略しない**: 整合性確認で問題を早期発見
5. **絵文字を使用しない**: コミットメッセージ、ドキュメント全てで禁止

## SDDワークフローとの統合

### sdd-documentationからの呼び出し

sdd-documentationスキルは、以下の順序でサブスキルを呼び出します：

```text
1. requirements-defining → requirements.md作成
2. software-designing → design.md作成
3. task-planning → tasks.md作成
4. task-executing → 実装＆逆順レビュー（このスキル）
```

### 完了条件

- すべてのタスクがDONEステータス
- 逆順レビューで不整合がない（または解消済み）
- すべてのコミットが作成済み
