# タスク管理ガイドライン

## AIエージェント向けタスク設計の原則

### 1. 具体性の原則

タスクは曖昧さを排除し、AIエージェントが迷わず実装できるレベルで記述する。

**悪い例**:
```markdown
#### タスク1.1: 認証機能を作る
**説明**: 認証機能を実装してください
**受入基準**:
- [ ] 認証ができる
```

**良い例**:
```markdown
#### タスク1.1: ユーザー認証APIエンドポイントの実装

**説明**:
`src/api/auth.ts`に以下のエンドポイントを実装する：
- POST /api/auth/login - ユーザーログイン処理
- POST /api/auth/logout - ログアウト処理
- JWTトークンを使用した認証方式
- bcryptでパスワードをハッシュ化

**受入基準**:
- [ ] login/logoutエンドポイントが実装されている
- [ ] JWTトークンが正しく生成・検証される
- [ ] パスワードがbcryptでハッシュ化されている
- [ ] エラーハンドリングが適切に実装されている
- [ ] ユニットテストが実装され、すべて通過する
```

### 2. 情報の完全性

サブエージェントが質問なしに作業を完了できるよう、必要な情報をすべて記載する。

#### 必須情報チェックリスト

**技術仕様**:
- [ ] 対象ファイルの絶対パス
- [ ] 使用するライブラリ/フレームワークのバージョン
- [ ] インポート文の具体的な記述
- [ ] 関数/クラスのシグネチャ
- [ ] 型定義（TypeScriptの場合）

**実装詳細**:
- [ ] 入力の形式と型
- [ ] 出力の形式と型
- [ ] エラーケースとその処理方法
- [ ] バリデーションの具体的なルール

**テスト仕様**:
- [ ] テストファイルのパス
- [ ] テストケースの具体的な内容
- [ ] 期待される入出力の具体例
- [ ] モックが必要な場合、その具体的な実装

**環境・設定**:
- [ ] 必要な環境変数とその値（または取得方法）
- [ ] 設定ファイルの変更点
- [ ] 依存パッケージの追加（具体的なバージョン）

### 3. 推測禁止の原則

「おそらく〜だろう」という推測に基づく記述を含めない。

**避けるべき表現**:
- 「おそらくJWTを使うだろう」
- 「たぶんこのパターンだろう」
- 「一般的には〜なので」
- 「〜と思われる」

**推奨される対応**:
1. 不明な情報をリストアップ
2. ユーザーに確認を求める
3. 確認済みの情報のみをタスクに記載

## タスク粒度の詳細ガイド

### シンプルな実装（10-20分）

**対象**:
- 単一ファイルの作成
- 基本的な関数の実装
- 設定ファイルの追加
- 型定義ファイルの作成

**例**:
```markdown
#### タスク: 環境変数の型定義追加

**説明**:
`src/types/env.d.ts`を作成し、環境変数の型定義を追加

**受入基準**:
- [ ] `src/types/env.d.ts`が存在する
- [ ] DATABASE_URL、JWT_SECRETの型が定義されている
- [ ] TypeScriptエラーがゼロ

**推定工数**: 10分
```

### 標準的な実装（20-40分）

**対象**:
- 複数ファイルの作成・編集
- APIエンドポイントの実装
- データモデルの定義
- 基本的なテストの作成

**例**:
```markdown
#### タスク: ユーザー一覧APIの実装

**説明**:
`src/api/users/index.ts`にGET /api/usersエンドポイントを実装

**技術的文脈**:
- フレームワーク: Express.js
- ORM: Prisma
- 既存パターン: `src/api/posts/index.ts`を参照

**実装手順（TDD）**:
1. テスト作成: `src/api/users/index.test.ts`
2. テスト実行: 失敗確認
3. 実装: エンドポイント実装
4. テスト通過確認

**受入基準**:
- [ ] GET /api/usersが実装されている
- [ ] ページネーションに対応（page, perPage）
- [ ] テストが3つ以上ある
- [ ] すべてのテストが通過

**推定工数**: 30分
```

### 複雑な実装（40-90分）

**対象**:
- 複数コンポーネントの統合
- 複雑なロジックの実装
- 包括的なテストの作成
- リファクタリング

**例**:
```markdown
#### タスク: 認証ミドルウェアとガード実装

**説明**:
JWT認証ミドルウェアとルートガードを実装

**対象ファイル**:
- `src/middleware/auth.ts` - 認証ミドルウェア
- `src/guards/roleGuard.ts` - ロールベースガード
- `src/utils/jwt.ts` - JWT操作ユーティリティ

**技術的文脈**:
- JWT: jsonwebtoken v9.0.0
- 既存ミドルウェア: `src/middleware/logger.ts`を参照

**受入基準**:
- [ ] 認証ミドルウェアが実装されている
- [ ] ロールガード（admin, user）が実装されている
- [ ] 無効なトークンで401を返す
- [ ] 権限不足で403を返す
- [ ] 各ファイルにテストがある
- [ ] カバレッジ80%以上

**推定工数**: 60分
```

## ステータス管理

### ステータス定義

| ステータス | 意味 | 次のアクション |
|-----------|------|---------------|
| `TODO` | 未着手 | 作業開始時にIN_PROGRESSに変更 |
| `IN_PROGRESS` | 作業中 | 完了時にREVIEWまたはDONEに変更 |
| `BLOCKED` | ブロック中 | ブロッカー解消後にIN_PROGRESSに戻す |
| `REVIEW` | レビュー待ち | レビュー完了後にDONEに変更 |
| `DONE` | 完了 | アーカイブ対象 |

### ステータス遷移図

```
     ┌─────────────────────────────────┐
     │                                 │
     v                                 │
   TODO ──> IN_PROGRESS ──> REVIEW ──> DONE
                │              │
                v              │
            BLOCKED ───────────┘
                │
                └──> IN_PROGRESS（ブロック解消後）
```

## 依存関係の記述

### 依存関係の種類

**前提タスク（必須）**:
```markdown
**依存関係**: タスク1.1（データモデルの定義）が完了していること
```

**環境依存**:
```markdown
**依存関係**:
- `npm install express`が実行済みであること
- 環境変数`.env`に`DATABASE_URL`が設定されていること
```

**並行可能**:
```markdown
**依存関係**: なし（タスク2.2と並行実行可能）
```

## リスク管理

### リスク評価マトリクス

|  | 低影響 | 中影響 | 高影響 |
|---|--------|--------|--------|
| **高確率** | 注意 | 対策必要 | 最優先対応 |
| **中確率** | 監視 | 注意 | 対策必要 |
| **低確率** | 受容 | 監視 | 注意 |

### リスク記述例

```markdown
### リスク1: 外部API応答遅延
**影響度**: 中
**発生確率**: 中
**軽減策**: タイムアウト設定、リトライ機構、キャッシュ導入

### リスク2: 既存コードとの互換性問題
**影響度**: 高
**発生確率**: 低
**軽減策**: 包括的なテスト作成、段階的なリリース
```

## 見積もりの補正

### 補正係数

| 状況 | 補正係数 |
|------|----------|
| 基本的な実装 | × 1.0-1.2 |
| 不確実性が中程度 | × 1.5 |
| 不確実性が高い | × 2.0 |
| 新しいライブラリ使用 | × 2.0-2.5 |
| 複雑な統合 | × 2.5 |

### 見積もり例

```
基本見積もり: 20分
不確実性: 新しいライブラリ（× 2.0）
最終見積もり: 40分
```

## 受入基準の書き方

### 検証可能な基準

**ファイル存在**:
- [ ] `src/components/Button.tsx`ファイルが作成されている

**機能動作**:
- [ ] POST /api/usersで新規ユーザーが作成される
- [ ] 無効な入力で400エラーが返される

**テスト通過**:
- [ ] `npm test`ですべてのテストが通過する
- [ ] カバレッジが80%以上

**コード品質**:
- [ ] ESLintエラーがゼロである
- [ ] TypeScriptエラーがゼロである

**パフォーマンス**:
- [ ] API応答時間が200ms以内

### 避けるべき基準

- [ ] コードがきれいである（主観的）
- [ ] 使いやすい（測定不能）
- [ ] 高速に動作する（具体的でない）
