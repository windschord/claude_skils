---
name: sdd-document-management
description: SDDドキュメントの整合性チェック、実装同期確認、アーカイブ、ファイル最適化を行う。ドキュメント間の矛盾検出、実装との乖離確認、完了タスクの整理、肥大化ファイルの分割が必要な場合に使用する。
version: "1.0.0"
---

# SDDドキュメント管理スキル

SDDワークフローで作成されたドキュメントのメンテナンス・整理を行い、品質と一貫性を維持します。

## 概要

| 問題 | 解決機能 |
|------|----------|
| ドキュメント間の仕様矛盾 | 整合性チェック |
| 実装とドキュメントの乖離 | 実装同期チェック |
| 完了済みタスクの蓄積 | アーカイブ |
| ファイルの肥大化 | ファイル最適化 |

### 共通原則

**すべての操作でユーザー承認を必須とする**

```text
チェック実行 → レポート出力 → ★ ユーザー承認 ★ → 修正/アーカイブ実行
```

**フルスキャン時はエージェントチームを使用する（必須）**

```text
フルスキャン選択時:
  → エージェントチームを作成して4機能を並列実行
  → 各メンバーがレポートを作成
  → リーダーが統合サマリーを作成
  → ★ ユーザー承認 ★
  → 修正は順次実行（ファイル競合回避）
```

## このスキルを使用する場面

- 開発フェーズの区切りやリリース前にドキュメント整理を行いたい場合
- ドキュメント間に矛盾を発見した場合
- 実装とドキュメントの不一致に気づいた場合
- ファイルが大きくなりすぎて管理が難しい場合
- 完了済みタスクが蓄積してindex.mdが見づらくなった場合

## 機能1: 整合性チェック

requirements、design、tasks間の矛盾や不整合を検出します。

- **要件→設計の整合性**: 要件カバレッジ、過剰設計、用語の一貫性
- **設計→タスクの整合性**: 設計カバレッジ、タスク過不足、参照の正確性
- **クロスリファレンス**: ID参照の有効性、ファイル参照、ステータス整合

**詳細**: [references/consistency_check_ja.md](references/consistency_check_ja.md)

## 機能2: 実装同期チェック

実装コードとドキュメントの乖離を検出します。

- **API同期**: エンドポイント、リクエスト/レスポンス、HTTPメソッド
- **データベース同期**: テーブル定義、カラム定義、リレーション
- **コンポーネント同期**: インターフェース、公開メソッド、依存関係
- **乖離の分類**: ドキュメント古い / 実装漏れ / 未文書化

**詳細**: [references/sync_check_ja.md](references/sync_check_ja.md)

## 機能3: アーカイブ

完了済みタスクや古い決定事項をアーカイブディレクトリに移動します。

- **完了タスク**: ステータスDONE → docs/sdd/archive/tasks/phase-N/
- **古い決定事項**: 明示的指定 or 一定期間経過 → docs/sdd/archive/decisions/
- **古いトラブルシューティング**: 修正完了 → docs/sdd/archive/troubleshooting/
- ファイル移動時にインデックス更新と参照のリンク更新を行う

**詳細**: [references/archive_ja.md](references/archive_ja.md)

## 機能4: ファイル最適化

肥大化したファイルの分割や重複内容の統合を提案します。

- **サイズ基準**: 500行未満=正常、500-1000行=注意、1000行以上=要対応
- **セクション数基準**: 10未満=正常、10-20=注意、20以上=要対応
- **重複基準**: 類似度30%未満=軽微、30-50%=注意、50%以上=要対応
- 機能別分割・フェーズ別分割のパターンを提案

**詳細**: [references/optimize_ja.md](references/optimize_ja.md)

## ユーザー対話ガイドライン

### スキル起動時

```text
SDDドキュメント管理を開始します。

どの機能を実行しますか？

1. 整合性チェック - ドキュメント間の矛盾を検出
2. 実装同期チェック - 実装とドキュメントの乖離を検出
3. アーカイブ - 完了タスク・古い決定事項を整理
4. ファイル最適化 - 肥大化ファイルの分割・重複統合
5. フルスキャン - 上記すべてをエージェントチームで並列実行
```

### フルスキャン選択時のエージェントチーム作成（必須）

フルスキャンが選択された場合、**必ずエージェントチームを作成**して4機能を並列実行する:

- メンバーA: 整合性チェック → `docs/sdd/reports/consistency/`
- メンバーB: 実装同期チェック → `docs/sdd/reports/sync/`
- メンバーC: アーカイブ対象検出 → `docs/sdd/reports/archive/`
- メンバーD: ファイル最適化分析 → `docs/sdd/reports/optimize/`

各メンバーはレポート作成のみ行い、修正は実行しない。リーダーが統合後にユーザー承認を得る。

**チーム作成プロンプト例**: `sdd-documentation/references/agent_teams_guide_ja.md`

### 修正実行前

修正内容をリスト化してユーザーに提示し、承認を得てから実行する。

## 成果物の保存

```text
docs/sdd/reports/
├── consistency/[YYYY-MM-DD].md
├── sync/[YYYY-MM-DD].md
├── archive/[YYYY-MM-DD].md
└── optimize/[YYYY-MM-DD].md
```

## 推奨実行タイミング

| タイミング | 推奨機能 |
|-----------|---------|
| フェーズ完了時 | アーカイブ、ファイル最適化 |
| リリース前 | フルスキャン |
| 仕様変更後 | 整合性チェック |
| 大規模実装後 | 実装同期チェック |

## エージェントチームによる並列チェック（フルスキャン時は必須）

**フルスキャン時はエージェントチームを作成して4機能を並列実行する。**各チームメンバーが独立したチェック機能を担当し、リーダーが結果を統合する。

```text
チームリーダー（自らチェックせず、進捗確認・成果統合に専念）
├── メンバーA: 整合性チェック → docs/sdd/reports/consistency/
├── メンバーB: 実装同期チェック → docs/sdd/reports/sync/
├── メンバーC: アーカイブ対象検出 → docs/sdd/reports/archive/
└── メンバーD: ファイル最適化分析 → docs/sdd/reports/optimize/
```

- レポート作成は並列、修正実行は順次（ファイル競合回避）
- リーダーは自らチェック作業をせず、メンバーの成果レビューと統合サマリー作成に専念
- 統合サマリー作成後、必ずユーザー承認を得る

## TodoWrite連携

- **アーカイブ時**: タスクをアーカイブしたらTodoWriteからも該当タスクを除外
- **整合性チェックによるタスク追加時**: `[TASK-XXX] [DocFix] 修正内容` の形式でTodoWriteにpendingとして追加

## リソース

### リファレンス
- 管理ガイドライン: `references/management_guide_ja.md`
- 整合性チェック: `references/consistency_check_ja.md`
- 実装同期チェック: `references/sync_check_ja.md`
- アーカイブ: `references/archive_ja.md`
- ファイル最適化: `references/optimize_ja.md`

### テンプレート
- 整合性チェックレポート: `assets/templates/consistency_report_template_ja.md`
- 実装同期チェックレポート: `assets/templates/sync_report_template_ja.md`
- アーカイブレポート: `assets/templates/archive_report_template_ja.md`
- 最適化レポート: `assets/templates/optimize_report_template_ja.md`
