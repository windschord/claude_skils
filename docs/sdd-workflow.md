# SDDワークフロー

SDD（ソフトウェア設計ドキュメント）スキルを使った開発ワークフローの詳細ガイドです。

## ドキュメントの関係性

```text
docs/requirements/ (何を作るか)
    ↓ 参照
docs/design/ (どのように作るか)
    ↓ 参照
docs/tasks/ (どのように実装するか)
    ↓ 参照
実装コード
```

## 出力ドキュメント構成

SDDスキルが生成するドキュメントは以下の構成です:

```text
docs/
├── requirements/           # 要件定義
│   ├── index.md           # 目次・概要
│   ├── stories/           # ユーザーストーリー詳細
│   │   └── US-XXX.md
│   └── nfr/               # 非機能要件
│       └── performance.md
├── design/                # 設計
│   ├── index.md           # 目次・アーキテクチャ概要
│   ├── components/        # コンポーネント詳細
│   ├── api/               # API設計詳細
│   ├── database/          # データベーススキーマ
│   └── decisions/         # 技術的決定事項
├── tasks/                 # タスク管理
│   ├── index.md           # 目次・進捗サマリ
│   └── phase-N/           # フェーズ別タスク
│       └── TASK-XXX.md
├── troubleshooting/       # トラブルシューティング
│   └── [YYYY-MM-DD]-[issue-name]/
│       └── analysis.md
├── archive/               # アーカイブ（完了済み）
│   ├── tasks/
│   ├── decisions/
│   └── troubleshooting/
└── reports/               # 管理レポート
    ├── consistency/
    ├── sync/
    ├── archive/
    └── optimize/
```

## 新規開発ワークフロー

### Phase 1: 要件定義

`requirements-defining`スキルでEARS記法を使って要件を定義します。

**EARS記法の基本パターン:**

| パターン | 形式 | 使用場面 |
|---------|------|----------|
| 基本 | `システムは〜しなければならない` | 常時適用される要件 |
| イベント | `〜の時、システムは〜しなければならない` | イベント駆動要件 |
| 条件 | `もし〜ならば、システムは〜しなければならない` | 状態依存要件 |
| 継続 | `〜の間、システムは〜しなければならない` | 継続的要件 |
| 場所 | `〜において、システムは〜しなければならない` | コンテキスト固有要件 |

**チェックポイント:**

- すべての要件がEARS記法に従っている
- 要件IDが一意（REQ-XXX、NFR-XXX）
- 各要件がテスト可能で測定可能

### Phase 2: 設計

`software-designing`スキルで要件を基に技術設計を文書化します。

**チェックポイント:**

- アーキテクチャ概要が記載されている
- 主要コンポーネントが定義されている
- インターフェースが明確
- 技術的決定事項と根拠が記載されている
- 情報の明確性チェックが完了している

### Phase 3: タスク計画

`task-planning`スキルで設計を基にタスクを分解します。

**チェックポイント:**

- タスクが適切な粒度に分解されている（20-40分程度）
- 各タスクに受入基準がある
- 依存関係が明確
- 推測に基づく実装指示が含まれていない

### Phase 4: タスク同期

TodoWriteにタスク一覧を同期し、進捗を可視化します。

| SDDステータス | TodoWriteステータス |
|-------------|-------------------|
| TODO | pending |
| IN_PROGRESS | in_progress |
| DONE | completed |
| BLOCKED | pending（[BLOCKED]付記） |
| REVIEW | in_progress（[REVIEW]付記） |

### Phase 5: ドキュメント逆順レビュー

タスク→設計→要件の順に整合性をチェックします。

```text
docs/tasks/ → docs/design/ → docs/requirements/
```

**確認項目:**

1. **タスク→設計**: タスクが参照するコンポーネント/APIはdesign/に定義されているか
2. **設計→要件**: すべての要件に対応する設計要素があるか
3. **過剰チェック**: 要件にない機能が設計やタスクに含まれていないか
4. **漏れチェック**: 設計やタスクに対応しない要件がないか

### Phase 6: 実装

`task-executing`スキルでタスクに沿って実装します。

### Phase 7: 実装逆順レビュー

実装→タスク→設計→要件の整合性をチェックします。

### Phase 8: 反復

プロジェクトの進展に応じて各スキルで更新します。

## トラブルシューティングワークフロー

エラーやバグに遭遇した場合は`sdd-troubleshooting`スキルを使用します。

```text
エラー発生
    ↓
sdd-troubleshootingスキルを使用
    ↓
1. 問題事象を確認
2. 根本原因を分析
3. 仕様との照合
4. 修正方針を策定
5. ユーザー承認を得る（必須ゲート）
6. タスク分割して実装
```

**対象となる状況:**

| 状況 | 例 |
|-----|-----|
| テストエラー | `npm test`失敗、アサーションエラー |
| ビルドエラー | コンパイルエラー、型エラー |
| 実行時エラー | 例外スロー、クラッシュ |
| 動作不良 | 期待と異なる動作 |

## エージェントチーム活用

### 前提条件

`CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS`を有効にする。

### 活用パターン

| パターン | 使用フェーズ | 説明 |
|---------|------------|------|
| 並列タスク実行 | task-executing | 依存関係のないタスクを並列実装 |
| 並列レビュー | 逆順レビュー | requirements↔design↔tasksの整合性を並列チェック |
| 競合仮説デバッグ | sdd-troubleshooting | 複数仮説を並列調査 |
| 並列ドキュメントチェック | sdd-document-management | 4機能を並列実行 |

### チーム運用ルール

1. **リーダーは実装禁止**: 進捗監視・成果レビュー・結果統合に専念
2. **ファイル競合回避**: 各メンバーが異なるファイルセットを所有
3. **プラン承認**: リスクの高いタスクではプラン承認を要求
4. **完了待機**: メンバーの完了を待ってから次のフェーズに進む
5. **タスク同期**: 完了時に`docs/tasks/`とTodoWriteの両方を更新

## 情報の明確性（重要原則）

すべてのドキュメント作成で以下を厳守してください:

1. **情報の分類**: 「明示された情報」と「不明な情報」を分けてリストアップ
2. **不明な情報の確認**: 不明な情報が1つでもあれば、実装前に必ず質問
3. **サブエージェント向け完全性**: サブエージェントが質問なしに実装できるレベルの情報を記載
