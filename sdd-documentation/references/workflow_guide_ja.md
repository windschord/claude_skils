# SDDワークフローガイド

## 概要

このガイドでは、SDD（ソフトウェア設計ドキュメント）の作成から完了までのワークフローを説明します。

## スキル構成

```text
sdd-documentation（オーケストレーター）
    │
    ├── requirements-defining（要件定義）
    │       └── docs/requirements/
    │               ├── index.md
    │               ├── stories/US-XXX.md
    │               └── nfr/*.md
    │
    ├── software-designing（設計）
    │       └── docs/design/
    │               ├── index.md
    │               ├── components/*.md
    │               ├── api/*.md
    │               ├── database/schema.md
    │               └── decisions/DEC-XXX.md
    │
    ├── task-planning（タスク計画）
    │       └── docs/tasks/
    │               ├── index.md
    │               └── phase-N/TASK-XXX.md
    │
    └── task-executing（タスク実行）
            └── 実装コード
```

## ワークフロー詳細

### フェーズ1: 初期化

**目的**: プロジェクトのドキュメント基盤を構築

**手順**:
1. docsディレクトリ構造を作成
2. 各index.mdテンプレートを配置
3. プロジェクト情報を確認

**成果物**:
```text
docs/
├── requirements/
│   ├── index.md（テンプレート）
│   ├── stories/
│   └── nfr/
├── design/
│   ├── index.md（テンプレート）
│   ├── components/
│   ├── api/
│   ├── database/
│   └── decisions/
└── tasks/
    ├── index.md（テンプレート）
    ├── phase-1/
    └── phase-2/
```

### フェーズ2: 要件定義

**使用スキル**: `requirements-defining`

**目的**: 何を作るかを明確に定義

**手順**:
1. プロジェクトの目的・対象ユーザーを確認
2. requirements/index.mdに概要を記述
3. 各ユーザーストーリーをstories/US-XXX.mdとして作成
4. EARS記法で受入基準を定義
5. 非機能要件をnfr/*.mdに追加
6. index.mdのリンクを更新
7. ユーザー確認・承認

**チェックポイント**:
- [ ] すべての要件がEARS記法に従っている
- [ ] 要件IDが一意である
- [ ] 各要件がテスト可能である
- [ ] index.mdに全ストーリーへのリンクがある
- [ ] ユーザーの承認を得た

### フェーズ3: 設計

**使用スキル**: `software-designing`

**目的**: どのように作るかを文書化

**手順**:
1. requirements/を読み込む
2. 不明点をユーザーに確認
3. design/index.mdにアーキテクチャ概要を記述
4. 各コンポーネントをcomponents/*.mdに定義
5. API設計をapi/*.mdに記述
6. データベーススキーマをdatabase/schema.mdに定義
7. 技術的決定をdecisions/DEC-XXX.mdに記録
8. index.mdのリンクを更新
9. 要件との整合性を確認
10. ユーザー確認・承認

**チェックポイント**:
- [ ] すべての要件に対応する設計要素がある
- [ ] 技術的決定事項と根拠が記載されている
- [ ] 情報の明確性チェックが完了している
- [ ] index.mdに全設計ドキュメントへのリンクがある
- [ ] ユーザーの承認を得た

### フェーズ4: タスク計画

**使用スキル**: `task-planning`

**目的**: どのように実装するかを計画

**手順**:
1. requirements/、design/を読み込む
2. 不明点をユーザーに確認
3. tasks/index.mdに進捗サマリを記述
4. フェーズ別ディレクトリ（phase-N/）を作成
5. 各タスクをphase-N/TASK-XXX.mdとして作成
6. 各タスクにTDD手順を追加
7. 依存関係を整理
8. index.mdのリンクを更新
9. ユーザー確認・承認

**チェックポイント**:
- [ ] タスクが適切な粒度である（20-40分）
- [ ] 各タスクに受入基準がある
- [ ] 推測に基づく実装指示がない
- [ ] index.mdに全タスクへのリンクがある
- [ ] ユーザーの承認を得た

### フェーズ5: 逆順レビュー

**使用スキル**: `sdd-documentation`または`task-planning`

**目的**: 3ドキュメント間の整合性を確認

**手順**:
```text
docs/tasks/
   ↓ タスクが参照するコンポーネント/APIは設計に定義されているか
docs/design/
   ↓ すべての要件に対応する設計要素があるか
docs/requirements/
```

**チェック項目**:

| チェック | 内容 |
|---------|------|
| タスク → 設計 | コンポーネント、API、データモデル、技術スタックの整合性 |
| 設計 → 要件 | 機能カバレッジ、非機能要件対応、過剰設計チェック |
| 過不足 | 要件にない機能がないか、実装漏れがないか |

**不整合発見時**:
1. 不整合をリストアップ
2. ユーザーに確認
3. 確認後にドキュメントを修正

### フェーズ6: 完了

**成果物**:
```text
docs/
├── requirements/
│   ├── index.md（完成版）
│   ├── stories/（各ユーザーストーリー）
│   └── nfr/（非機能要件）
├── design/
│   ├── index.md（完成版）
│   ├── components/（コンポーネント設計）
│   ├── api/（API設計）
│   ├── database/（スキーマ）
│   └── decisions/（技術的決定）
└── tasks/
    ├── index.md（完成版）
    └── phase-N/（タスク詳細）
```

**最終チェック**:
- [ ] 3ドキュメントすべてが完成している
- [ ] 各index.mdに全ファイルへのリンクがある
- [ ] 逆順レビューが完了している
- [ ] 不整合がすべて解消されている
- [ ] ユーザーの最終承認を得た

## 使い分けガイド

### 一括フロー（推奨）

**使用スキル**: `sdd-documentation`

**適した場面**:
- 新規プロジェクトの立ち上げ
- ドキュメント一式を最初から作成
- 全体の整合性を重視

### 個別フロー

**使用スキル**: 各サブスキル

**適した場面**:
- 既存ドキュメントの一部を修正
- 特定のフェーズのみ作業
- 段階的にドキュメントを作成

| 作業内容 | 使用スキル |
|---------|-----------|
| 要件の追加・修正 | `requirements-defining` |
| 設計の更新 | `software-designing` |
| タスクの追加・更新 | `task-planning` |
| 整合性チェック | `sdd-documentation` |

## トラブルシューティング

### 不整合が多い場合

1. まず要件定義（requirements/）を見直す
2. 要件が明確になったら設計（design/）を修正
3. 最後にタスク（tasks/）を更新

### 情報が不足している場合

1. 不明点をリストアップ
2. ユーザーに確認
3. 確認済み情報のみでドキュメント作成
4. 推測は絶対に行わない

### スコープが大きすぎる場合

1. 優先度の高い要件を特定
2. MVP（最小限の製品）スコープを定義
3. フェーズ分けして段階的に実装

## エージェントチーム活用ワークフロー

### 概要

SDDワークフローの特定フェーズでエージェントチームを活用し、並列作業で効率を向上させます。

### チーム活用タイミング

```text
フェーズ1: 初期化         → 単一セッション
フェーズ2: 要件定義       → 単一セッション
フェーズ3: 設計           → 単一セッション
フェーズ4: タスク計画     → 単一セッション
                           ★ TodoWriteにタスク一覧を同期 ★
フェーズ5: 逆順レビュー   → エージェントチーム（並列レビュー）
フェーズ6: タスク実行     → エージェントチーム（並列実行）
                           ★ 完了ごとにTodoWriteを更新 ★
フェーズ7: 完了           → 単一セッション
```

### タスク実行フェーズのチーム活用

1. docs/tasks/index.mdから並列実行可能なタスクグループを確認
2. 依存関係のないタスク群をチームメンバーに割り当て
3. 各メンバーがTDD手順に従い独立して実装
4. 全メンバー完了後にTodoWriteを一括更新
5. 逆順レビューを実施

### トラブルシューティングでのチーム活用

原因不明のバグで複数の仮説がある場合:

1. 各仮説に調査員（チームメンバー）を割り当て
2. 並列で調査を実行
3. メンバー間で発見を共有・反証
4. リーダーが調査結果を統合
5. 最有力の根本原因を特定

### ドキュメント管理でのチーム活用

フルスキャン時に4機能を並列実行:

1. 整合性チェック
2. 実装同期チェック
3. アーカイブ対象検出
4. ファイル最適化分析

**注意**: レポート作成は並列、修正実行は順次

## タスク同期（TodoWrite連携）

### 概要

docs/tasks/のタスクとClaude CodeのTodoWriteを同期し、ユーザーに進捗をリアルタイム表示します。

### 同期タイミング

| タイミング | 操作 |
|-----------|------|
| タスク計画完了 | TodoWriteにタスク一覧を一括登録 |
| タスク開始 | 該当タスクをin_progressに |
| タスク完了 | 該当タスクをcompletedに |
| タスクブロック | contentに[BLOCKED]付記 |
| タスク追加 | TodoWriteにpendingで追加 |

### ステータス対応

| SDD | TodoWrite |
|-----|-----------|
| TODO | pending |
| IN_PROGRESS | in_progress |
| DONE | completed |
| BLOCKED | pending（[BLOCKED]付記） |

詳細: `references/task_sync_guide_ja.md`

## ベストプラクティス

1. **ユーザー確認を怠らない**: 各フェーズ完了時に必ず確認
2. **推測しない**: 不明点は必ず質問
3. **整合性を維持**: 変更時は他ドキュメントへの影響を確認
4. **具体的に記述**: 曖昧な表現を避け、測定可能な値を使用
5. **TDDを遵守**: タスクには必ずテスト手順を含める
6. **TodoWriteを同期**: タスク状態変更時は必ずTodoWriteも更新
7. **チームを適切に活用**: 並列化可能な作業はエージェントチームで効率化
8. **ファイル競合を回避**: チーム実行時は各メンバーの対象ファイルを分離
